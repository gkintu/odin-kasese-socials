#!/bin/sh

echo "Husky pre-commit hook running..." >&2

echo "Running linter (npm run lint)..." >&2
npm run lint
lint_exit_code=$?
echo "Lint command finished with exit code: $lint_exit_code" >&2

if [ $lint_exit_code -ne 0 ]; then
  echo "Linting failed. Aborting commit." >&2
  exit $lint_exit_code
fi

echo "Linting passed."
echo "Running formatter (npm run format)..." >&2
npm run format
format_exit_code=$?
echo "Format command finished with exit code: $format_exit_code" >&2

if [ $format_exit_code -ne 0 ]; then
  echo "Formatting failed. Aborting commit." >&2
  exit $format_exit_code
fi

echo "Formatting passed."
# Add changes made by the formatter to the commit
# If 'npm run format' modified files, this ensures they are included.
# You might want to use a more specific 'git add' command depending on your 'npm run format' script.
echo "Staging changes made by formatter..." >&2
git add .

echo "Pre-commit checks passed. Proceeding with commit." >&2
exit 0
